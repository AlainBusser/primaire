<html lang="fr">
  <head>
    <title>Dodgem</title>
    <meta charset="utf-8">
  <link rel="stylesheet" href="../css/dodgem.css" />
  <script src="../javascript/coffee-script.js"></script>
  <script src="../javascript/jquery.min.js"></script>
  </head>
  <body>
	  <h1>Dodg'em</h1>
	  <p>Deux écuries sont en présence:
	  <ul>
		  <li>Les voitures rouges d'Enzo Pericoloso (en bas)</li>
		  <li>Les voitures bleues de Porshe-Gersi</li>
	  </ul>
	  Les voitures sont prêtes pour la course, mais il faut les sortir du parking 
	  (ci-dessous), case par case. Les voitures ne peuvent reculer 
	  (les voitures bleues ne peuvent aller vers la gauche, les 
	  voitures rouges ne peuvent aller vers le bas), mais on peut 
	  les décaler vers leur gauche ou leur droite. Les voitures 
	  bleues ne peuvent sortir que par leur ligne d'arrivée à droite, 
	  les voitures rouges ne peuvent sortir que par leur ligne d'arrivée 
	  en haut.
	  </p>
	  <p>Pour bouger une voiture, cliquer sur le trait gris qu'on veut 
	  lui faire traverser. Le premier qui a réussi à sortir ses deux voitures 
	  du parking a gagné ce jeu. Les rouges commencent.</p>
	  <table>
		  <tr> <!-- ligne rouge d'arrivée -->
			  <td></td>
			  <td></td>
			  <td class="gr"></td>
			  <td></td>
			  <td class="gr"></td>
			  <td></td>
			  <td class="gr"></td>
			  <td></td>
			  <td class="gr"></td>
			  <td></td>
			  <td></td>
		  </tr>
		  <tr> <!-- les jonctions horizontales du haut -->
			  <td></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td></td>
		  </tr>
		  <tr> 
			  <td class="gb"></td>
			  <td class="jv"></td>
			  <td class="rue bleu"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="gb"></td>
		  </tr>
		  <tr> 
			  <td></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td></td>
		  </tr>
		  <tr> 
			  <td class="gb"></td>
			  <td class="jv"></td>
			  <td class="rue bleu"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="gb"></td>
		  </tr>
		  <tr> 
			  <td></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td></td>
		  </tr>
		  <tr> 
			  <td class="gb"></td>
			  <td class="jv"></td>
			  <td class="rue bleu"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="gb"></td>
		  </tr>
		  <tr> 
			  <td></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td></td>
		  </tr>
		  <tr> 
			  <td class="gb"></td>
			  <td class="jv"></td>
			  <td class="rue"></td>
			  <td class="jv"></td>
			  <td class="rue rouge"></td>
			  <td class="jv"></td>
			  <td class="rue rouge"></td>
			  <td class="jv"></td>
			  <td class="rue rouge"></td>
			  <td class="jv"></td>
			  <td class="gb"></td>
		  </tr>
		  <tr> 
			  <td></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td class="jh"></td>
			  <td class="pc"></td>
			  <td></td>
		  </tr>
		  <tr> 
			  <td></td>
			  <td></td>
			  <td class="gr"></td>
			  <td></td>
			  <td class="gr"></td>
			  <td></td>
			  <td class="gr"></td>
			  <td></td>
			  <td class="gr"></td>
			  <td></td>
			  <td></td>
		  </tr>
	  </table>
	  <h3>C'est au joueur <span class="joueur">rouge</span> de jouer.</h3>
	  <script type="text/coffeescript">
joueur = 0
joueurs = ["rouge","bleu"]
couleurs = ["red","blue"]
suivant = ->
	joueur = 1-joueur
	$(".joueur").text(joueurs[joueur]).css "color", couleurs[joueur]
$ ->
	$(".jv").on "click", ->
		if joueur is 1
			if $(this).prev().hasClass("bleu") 
				unless $(this).next().hasClass("bleu") or $(this).next().hasClass("rouge") or $(this).next().hasClass("gb")
					$(this).next().addClass("bleu").prev().prev().removeClass("bleu")
					suivant()
				if $(this).next().hasClass("gb")
					$(this).prev().removeClass "bleu"
					suivant()
		else
			if $(this).next().hasClass("rouge")
				unless $(this).prev().hasClass("bleu") or $(this).prev().hasClass("rouge") or $(this).prev().hasClass("gb")
					$(this).prev().addClass("rouge").next().next().removeClass("rouge")
					suivant()
			else if $(this).prev().hasClass("rouge")
				unless $(this).next().hasClass("bleu") or $(this).next().hasClass("rouge") or $(this).next().hasClass("gb")
					$(this).next().addClass("rouge").prev().prev().removeClass("rouge")
					suivant()

	$(".jh").on "click", ->
		numero = $(this).index() 			# vaut 2, 4 ou 6
		haut = $(this).closest('tr').prev().find("td:nth-child(#{numero+1})")
		bas = $(this).closest('tr').next().find("td:nth-child(#{numero+1})")
		if joueur is 0
			unless haut.hasClass("rouge") or haut.hasClass("bleu") or haut.hasClass("gr")
				if bas.hasClass "rouge"
					bas.removeClass "rouge"
					haut.addClass "rouge"
					suivant()
			if haut.hasClass "gr"
				bas.removeClass "rouge"
				suivant()
		else
			if bas.hasClass "bleu"
				unless haut.hasClass("rouge") or haut.hasClass("bleu") or haut.hasClass("gr")
					bas.removeClass "bleu"
					haut.addClass "bleu"
					suivant()
			else if haut.hasClass "bleu"
				unless bas.hasClass("bleu") or bas.hasClass("rouge") or bas.hasClass("gr")
					haut.removeClass "bleu"
					bas.addClass "bleu"
					suivant()
			

			
	  </script>
  </body>
</html>
